
<!DOCTYPE html>
<html lang="en">
<head>
  <!-- TODO: Change maximum-scale=1 to 5 for improved accesiblity score. -->
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=5">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- Primary Meta Tags -->
  <title>QR Code Scanner - ScanApp</title>

  <link rel="preload" href=/assets/main.css as="style">
  <link rel="stylesheet" href=/assets/main.css>
 
  <link rel="preload" href=/assets/app.v2.6.0.css as="style">
  <link rel="stylesheet" href="/assets/app.v2.6.0.css">
  <link rel="preload" href="https://scanapp.pages.dev/css/index.v2.5.1.css" as="style">
  <link rel="stylesheet" href="https://scanapp.pages.dev/css/index.v2.5.1.css">

  <!-- <link rel="preload" href="/assets/js/scanapp-js.pro.min.v2.5.9.js" as="script">
  <script defer src="/assets/js/scanapp-js.pro.min.v2.5.9.js"></script> -->
  <script src="./config/frontend-connection.js"></script>
  <script src="./js/upstream.pro.maybe.js"></script>

  <base target="_parent">

  <link rel="preconnect" href="https://www.googletagmanager.com">
  <link rel="preconnect" href="https://www.google-analytics.com">
</head>
<body data-instant-allow-query-string data-instant-allow-external-links>
    <div> <div class="scanapp-top-container">
    <div class="scanapp-top-container-row">
        <div id="desktop-scanapp-left-container" class="scanapp-l1-container">
            <div id="scanapp-left-container-parent">
                <div class="desktop-header-area">
                    <!--
                    <div class="desktop-logo">
                        <img src="/assets/svg/scanapp.svg" alt="logo" width="160px" height="40px" alt="logo" />
                    </div>
                    <div class="desktop-header-links">
                        <a href="./blog">Blog</a>
                        <a href="./support" >Support</a>
                        <a href="https://medium.com/qr-code">Medium</a>
                    
                    </div>
                    -->
                </div>
                <div class="desktop-render-area">
                    <div id="reader-container">
                        <div id="reader"></div>
                    </div>
                </div>
                <div class="desktop-footer-area ">
                    <!--
                    <div class="desktop-footer-area-top-panel">
                        Built with <span class="heart">&hearts;</span> using <a href="https://github.com/mebjas/html5-qrcode">mebjas/html5-qrcode</a>
                    </div>
                    <div class="desktop-footer-area-bottom-panel">
                        <div class="desktop-footer-area-bottom-panel-col">
                            <div>
                                <a href="https://github.com/scanapp-org/scanapp-org.github.io/issues/new">Report issue</a>
                            </div>
                        </div>
                        <div class="desktop-footer-area-bottom-panel-col">
                            <div>
                                <a href="https://github.com/scanapp-org">Open source projects</a>
                            </div>
                        </div>
                        <div class="desktop-footer-area-bottom-panel-col">
                            <div>
                                <a href="https://mediapanda.org/">Images converted with MediaPanda</a>
                            </div>
                            <div>
                                <a href="https://www.freepik.com/vectors/technology">Vector assets from freepik</a>
                            </div>
                        </div>
                        <div class="desktop-footer-area-bottom-panel-col">
                            <div>
                                
                            </div>
                        </div>
                    </div>
                    -->
                </div>
            </div>
        </div>
        <div id="desktop-scanapp-right-container" class="scanapp-l1-container">
            <div class="desktop-right-container-top-panel">
                <div class="desktop-right-container-top-panel-text">
                     <!-- TODO: Move to H1-->
                     <div class="desktop-text-data-title">QR Code Scanner - ScanApp</div>
                     <div class="desktop-text-data-subtitle">Scanning is done locally on your device</div>
                </div>
                <!-- TODO: Top panel options -- implement this. -->
                <div class="desktop-right-container-top-panel-options" style="display: none;">
                    <div class="desktop-right-container-top-panel-option">
                        <div class="action-icons">
                            <img src="./assets/images/icons/dark_mode.svg" alt="Dark Mode" height="36px" />
                        </div>
                    </div>
                    <div class="desktop-right-container-top-panel-option">
                        <div class="action-icons">
                            <img src="./assets/images/icons/settings.svg" alt="settings" height="36px" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="desktop-right-container-panel desktop-right-container-result-panel">
                <div class="desktop-result-panel-header">
                    <div class="desktop-result-panel-header-title">
                        <!--
                            <div class="desktop-result-panel-header-title-icon">
                                <img src="./assets/images/icons/qr.svg" alt="qr" height="24px" />
                            </div>
                        -->
                        <div class="desktop-result-panel-header-title-text">Scan Result</div>
                    </div>
                    <div class="desktop-result-panel-header-actions">
                        <!-- TODO: Make this dynamic -- expand less for phone is opposite -->
                        <div class="action-icons" id="result-panel-minimize-action">
                            <img src="./assets/images/icons/expand_less.svg" alt="minimize" width="48px" height="48px" />
                        </div>
                    </div>
                </div>
                <div class="desktop-result-panel-body" id="result-panel-body-id">
                    <div class="desktop-result-panel-body-placeholder" id="result-panel-placeholder">
                        <div id="image-place-holder-qr-placeholder">
                            <img src="https://scanapp.pages.dev/images/qr-scan-placeholder.png"
                                loading="lazy"
                                alt="Scan to get results" />
                        </div>
                        <div>Scan to get results</div>
                    </div>
                    <div class="desktop-result-panel-body-actual mobile-popup-banner" id="result-panel-container">
                        <div>
                            <div class="header">
                                New <span id="scan-result-code-type">{code}</span> detected!
                            </div>
                            <div class="section">
                                <div class="image" id="scan-result-image"></div>
                                <div class="data">
                                    <table id="result_table">
                                        <tr>
                                            <td colspan="2">
                                                <div>
                                                    <div class="badge">
                                                        <div class="badge-icon">
                                                            <span><b>Type</b></span>
                                                        </div>
                                                        <div class="badge-text">
                                                            <span id="scan-result-badge-body">{type}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div id="scan-result-parsed">{parsed result here}</div>
                                            </td>
                                        </tr>
                                        <tr style="display:none">
                                            <td>Text</td>
                                            <td style="word-break: break-word">
                                                <div id="scan-result-text">{text result here}</div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Enter Job Code</td>
                                            <td>
                                                <input style="width:100%" type="text" id="jobCode" name="jobCode" placeholder="Job Code ID" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="text-align:center; padding-top:20px" colspan="2">
                                                <button class="scanapp-button" id="sendJobCode">Submit</button>
                                            </td>
                                        </tr>
                                        
                                        <tr style="display:none">
                                            <td>Actions</td>
                                            <td>
                                                <img class="action_image" id="action-share" alt="Share the result"
                                                        src="./assets/svg/share-svgrepo-com.svg" width="20px" height="20px">
                                                <img class="action_image"
                                                    width="20px" height="20px"
                                                    id="action-copy" 
                                                    alt="Copy the result text"
                                                    src="./assets/svg/copy-svgrepo-com.svg">
                                                <img class="action_image" id="action-payment" alt="Make a payment"
                                                    src="./assets/svg/coin-svgrepo-com.svg" style="display: none"
                                                    width="20px" height="20px">
                                                <img class="action_image" id="action-url"  alt="Open the URL"
                                                    src="./assets/svg/link2.svg" style="display: none;"
                                                    width="20px" height="20px">
                                                <img class="action_image" id="action-download"  alt="Download text"
                                                    src="./assets/images/icons/download.svg"
                                                    width="20px" height="20px">
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div id="body-footer" class="footer">
                            <div id="scan-quick-action">
                                <div id="scan-quick-action-header">
                                    <span id="scan-quick-action-header-icon">
                                        <img alt="Open the URL" src="./assets/svg/link2.svg" width="20px" height="20px" />
                                    </span>
                                    <span>
                                        Click to open <span id="scan-quick-action-header-text">scanapp.org/blog/somthing/or/other</span>
                                    </span>
                                </div>
                                <div id="scan-quick-action-body">
                                    <div id="scan-quick-action-body-title"></div>
                                    <div id="scan-quick-action-body-description"></div>                                        
                                </div>
                            </div>

                            <button id="scan-result-close" class="scanapp-button">
                                Close and scan another
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- TODO: Implement history feature and enable this UI. -->
            <div class="desktop-right-container-panel desktop-right-container-history-panel hidden-initially">
                <div class="desktop-result-panel-header">
                    <div class="desktop-result-panel-header-title">
                        <!-- <div class="desktop-result-panel-header-title-icon">
                            <img src="./assets/images/icons/history.svg" alt="history" height="36px" />
                        </div> -->
                        <div class="desktop-result-panel-header-title-text">Scan History</div>
                    </div>
                    <div class="desktop-result-panel-header-actions">
                        <div class="action-icons">
                            <img src="./assets/images/icons/delete.svg" alt="clear" height="36px" />
                        </div>
                        <div class="action-icons" id="history-panel-minimize-action">
                            <img src="./assets/images/icons/expand_less.svg" alt="minimize" width="48px" height="48px" />
                        </div>
                    </div>
                </div>
                <div class="desktop-result-panel-body desktop-result-panel-scan-history" id="history-panel-body-id">
                    <!-- Migrate to JS based creation -->
                    <div class="desktop-result-panel-scan-history-placeholder">
                        No scan history
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mobile specific containers-->
<div id="mobile-popup-scrim"></div>
<div class="mobile-bottom-navbar" id="mobile-bottom-navbar-id">
    <div class="mobile-bottom-navbar-option">
        <div class="menu-icons inactive" id="navbar-menu-icon-qr">
            <img src="./assets/images/icons/qr.svg" alt="QR" height="36px" />
        </div>
    </div>
    <div class="mobile-bottom-navbar-option">
        <div class="menu-icons" id="navbar-menu-icon-menu">
            <img src="./assets/images/icons/menu.svg" alt="menu" height="36px" />
        </div>
    </div>
</div>

<div class="mobile-popup-banner" id="mobile-about-panel">
    <div>
        <div class="header">
            <div class="mobile-about-logo">
                <img src="/assets/svg/scanapp.svg" alt="logo" width="160px" height="40px" alt="logo" />
            </div>
        </div>
        <div class="body">
            <div class="mobile-about-text-panel">
                <div>
                    Scanning is done locally on your device
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <div class="mobile-about-links-panel">
        </div>
        <div>
            <button id="scan-about-close" class="scanapp-button">Close</button>
        </div>
    </div>
</div>

<!-- TODO: Merge with desktop history later. -->
<div class="mobile-popup-banner" id="mobile-history-panel">
    <div>
        <div class="header">
            <div class="mobile-history-panel-header-text">Scan History</div>
        </div>
        <div class="body">
            <div class="mobile-history-panel-text">
                <div>
                    Thanks for showing interest in this feature.
                </div>
                <div>
                    QR scan history support coming soon!
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <button id="scan-history-close" class="scanapp-button">Close</button>
    </div>
</div>

<!-- General containers -->
<!-- TODO: replace icons with material-->
<div class="banners-container">
    <div class="banners">
        <div class="banner error">
        <!-- <div class="banner-icon"><i data-eva="alert-circle-outline" data-eva-fill="#ffffff" data-eva-height="48" data-eva-width="48"></i></div> -->
        <div class="banner-message" id="banner-error-message">{}</div>
        <div class="banner-close"><i data-eva="close-outline" data-eva-fill="#ffffff"></i></div>
        </div>
        <div class="banner success">
        <!-- <div class="banner-icon"><i data-eva="checkmark-circle-outline" data-eva-fill="#ffffff" data-eva-height="48" data-eva-width="48"></i></div> -->
        <div class="banner-message" id="banner-success-message">{}</div>
        <div class="banner-close"><i data-eva="close-outline" data-eva-fill="#ffffff"></i></div>
        </div>
    </div>
</div>

 </div>
<script type="text/javascript">
    const submitJobCodeButton = document.getElementById('sendJobCode');
    submitJobCodeButton.addEventListener('click', processJobCode);

    async function processJobCode() {
        const jobCode = document.getElementById('jobCode');
        const textDetected = document.getElementById('scan-result-parsed').innerText;

        if (jobCode === null || jobCode.value === '') {
            alert("Please enter a Job Code ID before submitting.")
            return;
        }

        alert("Sending '" + textDetected.replace(/(\r\n|\n|\r)/gm, "") + "' for Job Code '" + jobCode.value + "' to service...")

        jsonData = {
            jobCode: jobCode.value,
            scannedText: textDetected.replace(/(\r\n|\n|\r)/gm, "")
        }
        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");

        try {
            const response = await fetch(apiEndpoint, {
                method: "POST",
                body: JSON.stringify(jsonData),
                headers: myHeaders,
            });
            if (!response.ok) {
                console.error(`Response status: ${response.status}`);
                alert(`Response status: ${response.status}`);
            }
            const json = await response.json();
            console.log(json);
            if (json.status === 'success') {
                alert('Job Code submitted successfully.');
            } else {
                alert('Job Code submission failed: ' + json.error);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Error:', error);
        }


    }
</script>
</body>

</html>